<!DOCTYPE html>
<html lang="zh-CN" layout:decorate="~{layout/decorate}">
<head>
	<title>注册账号</title>
	<!-- Layui -->
	<link th:href="@{/webjars/layui/css/layui.css}" rel="stylesheet" />
</head>
<body layout:fragment="content">
	<div class="layui-container" style="padding-top: 20px;">
		<div class="layui-row">
			<div class="layui-col-md12">
				<form class="layui-form">
					<div class="layui-form-item">
						<label class="layui-form-label">登录账号</label>
						<div class="layui-input-block">
							<input type="text" 
								name="username"
								lay-verify="required" 
								placeholder="请输入账号" 
								autocomplete="off"
								class="layui-input" 
								/>
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">登录密码</label>
						<div class="layui-input-block">
							<input type="password" 
								name="password"
								lay-verify="required" 
								placeholder="请输入密码" 
								autocomplete="new-password"
								class="layui-input" 
								/>
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">确认密码</label>
						<div class="layui-input-block">
							<input type="password" 
								name="confirmpwd"
								lay-verify="required" 
								placeholder="请确认密码" 
								autocomplete="new-password"
								class="layui-input" 
								/>
						</div>
					</div>
					<button type="button" class="layui-btn layui-btn-fluid layui-btn-danger" lay-submit lay-filter="formRegister">注册</button>
				</form>
			</div>
		</div>
	</div>
<script type="text/javascript">
	layui.use('form', function() {
		var form = layui.form;
		form.on('submit(formRegister)', function(data) {
			if(!data.field.username){
				layer.msg("登录账号为空", { icon: 5, shift:6, time: 1200, offset: '0px' });
				return;
			}
			
			if(data.field.password != data.field.confirmpwd){
				layer.msg("两次输入的密码不一致", { icon: 5, shift:6, time: 1200, offset: '0px' });
				return;
			}
			
			var pwdRegExp = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*\\W)[\\s\\S]{6,20}");
			if(!pwdRegExp.test(data.field.password)){
	            layer.msg("密码限定6~20个字符，大小写字母、数字及特殊字符至少各一个", { icon: 5, shift:6, time: 5000, offset: '0px' });
				return;
			}
			
			$.post(ctx + "/doRegister", 
				{ username: data.field.username, password: data.field.password, confirmpwd: data.field.confirmpwd }, 
				function(response) {
					if(response.statusCode === 200) {
						parent.layer.msg("注册成功", { icon: 1, time: 1500 });
						parent.layer.close(parent.window.editPwdLayerIndex);
					} else {
						layer.msg(response.message, { icon: 5, shift:6, time: 1200, offset: '0px' });
					}
				});
	    	return false;
		});
	});
</script>
</body>
</html>