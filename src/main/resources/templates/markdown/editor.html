<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title th:text="${markdown.name}">Markdown文档</title>
	<meta charset="UTF-8" />
	<meta name="renderer" content="webkit" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
	<!-- Ico -->
    <link th:href="@{/static/favicon.ico}" rel="shortcut icon" />
	<!-- Jquery -->
	<script type="text/javascript" th:src="@{/webjars/jquery/dist/jquery.min.js}"></script>
	<!-- Editor.md -->
	<link rel="stylesheet" th:href="@{/static/markdown/editor.md-1.5.0/css/editormd.min.css}" />
	<script th:src="@{/static/markdown/editor.md-1.5.0/editormd.js}"></script>
	<!-- Layui -->
	<link th:href="@{/webjars/layui/css/layui.css}" rel="stylesheet" />
	<script th:src="@{/webjars/layui/layui.js}"></script>
	<!-- 样式修正 -->
	<link rel="stylesheet" th:href="@{/static/css/markdown.css}" />
</head>
<body>
	<div id="editormd" class="noborder"></div>
	<textarea id="markdown" style="display: none;" th:text="${markdown.content}"></textarea>
	<script type="text/javascript">
		$(function () {
			editormd("editormd", {
				width: document.body.clientWidth,
				height: document.body.clientHeight,
            	path: "[(@{/static/markdown/editor.md-1.5.0/lib/})]",
                theme: "default",
                previewTheme: "default",
                editorTheme: "default",
                markdown: $("#markdown").val(),
                codeFold: true,
                saveHTMLToTextarea: true,
                searchReplace: true,
                htmlDecode: "style,script,iframe|on*",  
                emoji: false,
                taskList: true,
                tocm: true,
                tex: true,
                flowChart: true,
                sequenceDiagram: true,
                imageUpload: true,
                imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
                imageUploadURL: "[(@{/markdown/ajax/upload})]",
                toolbarIcons: function () {
                	var toolbarIcons = editormd.toolbarModes.full;
                	if (toolbarIcons.indexOf("emoji") >= 0) {
                		toolbarIcons.splice(toolbarIcons.indexOf("emoji"), 1);
                	}
                	if (toolbarIcons.indexOf("fullscreen") >= 0) {
                		toolbarIcons.splice(toolbarIcons.indexOf("fullscreen"), 1);
                	}
                	if (toolbarIcons.indexOf("info") >= 0) {
                		toolbarIcons.splice(toolbarIcons.indexOf("info"), 1);
                	}
                	if (toolbarIcons.indexOf("save") < 0) {
                		toolbarIcons.unshift("|");
                    	toolbarIcons.unshift("save");
                	}
                	return toolbarIcons;
                },
                toolbarIconsClass: {
                	save: "fa fa-save"
                },
                lang: {
                    toolbar: {
                    	save: "保存"
                    }
                },
                toolbarHandlers: {
                	save: function (cm, icon, cursor, selection) {
                		var that = this;
                		layer.load(2);
                		$.post("[(@{/markdown/ajax/save})]", {
                			"[(${_csrf.parameterName})]": "[(${_csrf.token})]",
                			uuid: "[(${markdown.uuid})]",
                			name: "[(${markdown.name})]",
                			content: that.getMarkdown()
                		}, function (resultJson) {
                			layer.closeAll();
                			if(resultJson.statusCode == 200) {
    							layer.msg(resultJson.message ? resultJson.message:"已保存", { icon: 1, time: 1500 });
    						} else {
    							layer.msg(resultJson.message ? resultJson.message:"出错了", { icon: 5, shift:6 });
    						}
                		});
                	}
                },
                onload: function () {
                	var that = this;
    	    		var originFn = window.onresize;
    	       		window.onresize = function () { 
    	       			originFn && originFn();
    	       			that.resize(document.body.clientWidth, document.body.clientHeight);
    	       		}
                }
            });
		});
	</script>
</body>
</html>