<!DOCTYPE html>
<html lang="zh-CN" layout:decorate="~{layout/decorate}">
<head>
	<title>工作台</title>
    <!-- TopJUI框架样式 -->
    <link type="text/css" th:href="@{/static/TopJUI-free/topjui/themes/default/topjui.core.min.css}" rel="stylesheet">
    <link type="text/css" th:href="@{/static/TopJUI-free/topjui/themes/default/topjui.smartness-blue.css}" rel="stylesheet" id="dynamicTheme"/>
    <link type="text/css" th:href="@{/static/TopJUI-free/topjui/themes/default/sidemenu_style.css}" rel="stylesheet" id="dynamicTheme"/>
</head>
<body layout:fragment="content" class="panel-noscroll">
	<div id="mm" class="submenubutton" style="width: 140px;">
	    <div id="mm-tabclose" name="6" iconCls="fa fa-refresh">刷新</div>
	    <div class="menu-sep"></div>
	    <div id="Div1" name="1" iconCls="fa fa-close">关闭</div>
	    <div id="mm-tabcloseother" name="3">关闭其他</div>
	    <div id="mm-tabcloseall" name="2">关闭全部</div>
	    <div class="menu-sep"></div>
	    <div id="mm-tabcloseright" name="4">关闭右侧标签</div>
	    <div id="mm-tabcloseleft" name="5">关闭左侧标签</div>
	    <div class="menu-sep"></div>
	    <div id="mm-newwindow" name="7">新窗口中打开</div>
	</div>
	<div id="index_layout" class="easyui-layout" data-options="fit:true">
		<div id="north" 
			class="banner"
	  		style="height: 50px; padding:0;margin:0; overflow: hidden;"
			data-options="region:'north',border:false,split:false">
			<div class="nav-bar">
	        	<div class="nav-left webname">
	                <span class="admin-nav-logo fa fa-image"></span>
	                <span class="systemname" style="margin-left: 8px;">MyGraph 在线画图</span>
	            </div>
	         	<div class="menu-collapse">
	            	<span class="collapseMenu" style="text-align: center;cursor: pointer;font-size: 18px;">
	              		<span id="menuCollapseIcon" class="fa fa-outdent"></span>
	          		</span>
	            </div>
	         	<div class="nav-right">
	                <span style="padding-right: 8px; height: 50px; line-height: 50px;">
	                	<a href="javascript:void(0);" 
	                		class="easyui-linkbutton"
	                     	style="color:#fff;"
	                     	data-options="iconCls:'fa fa-user',plain:true">
	                     	<span id="user-nickname" sec:authentication="principal.nickname"></span>
	                 	</a>|
	                  	<a href="javascript:void(0);"
	                  		class="easyui-menubutton"
	                  		style="color:#fff;"
	                    	data-options="menu:'#mmSetting',iconCls:'fa fa-cog',hasDownArrow:true">设置
	                   	</a>
	                	<div id="mmSetting" style="width:74px;">
	                  		<div data-options="iconCls:'fa fa-info-circle'" onclick="javascript:modifyPwd(0);">个人信息</div>
	                       	<div class="menu-sep"></div>
	                     	<div data-options="iconCls:'fa fa-key'" onclick="javascript:modifyPwd(0);">修改密码</div>
	                	</div>|
	                   	<form class="easyui-menubutton"
	                   		style="color: #fff;cursor: pointer;"
	                   		data-options="iconCls:'fa fa-sign-out',hasDownArrow:false"
							th:action="@{/logout}" method="post" onclick="this.submit();">
							<button type="submit" style="border: none;background-color: transparent;color: #fff;cursor: pointer;">注销</button>
						</form>
	           		</span>
	        	</div>
				<div class="nav-center">
	          		<a class="nav-btn nav-left-btn topmenu hide" href="#" style="float: left;">
	          			<i class="fa fa-angle-double-left" aria-hidden="true"></i>
	          		</a>
	                <a class="nav-btn nav-right-btn topmenu hide" href="#" style="float: right;">
	                	<i class="fa fa-angle-double-right" aria-hidden="true"></i>
	                </a>
	          		<div style="overflow: hidden;position: relative;text-align: left;">
	             		<ul class="nav-group">
	                    	<li id="1325" title="TopJUI静态演示" class="topmenu selected">
	                      		<a class="l-btn-text bannerMenu" href="javascript:void(0);">
	                                <p><lable class="fa fa-tree" style="color: #F7B824;"></lable></p>
	                                <p><span style="white-space:nowrap;">静态演示</span></p>
	                       		</a>
	                        </li>
	                        <li id="60" title="TopJUI开发文档" class="topmenu">
	                            <a class="l-btn-text bannerMenu" href="javascript:void(0);">
	                                <p><lable class="fa fa-book" style="color: #FF5722;"></lable></p>
	                                <p><span style="white-space:nowrap;">开发文档</span></p>
	                            </a>
	                        </li>
	                        <li id="9003" class="topmenu lastMenu" data-type="lastMenu">
	                            <a class="l-btn-text bannerMenu moreBox" target="_blank">
	                                <p><lable class="fa fa-th"></lable></p>
	                                <p><span style="white-space:nowrap;">更多功能</span></p>
	                            </a>
	                            <div id="moreMenu">
	                           		<ul style="padding: 0;">
	                               		<li id="90031" class="topmenu">
	                                   		<div class="l-btn-text bannerMenu" onclick="addParentTab({href:'http://www.topjui.com/compile',title:'在线编译'});">
	                                       		<p><lable class="fa fa-code" style="color: rebeccapurple;"></lable></p>
	                                            <p><span style="white-space:nowrap;">在线调试</span></p>
	                                        </div>
	                                    </li>
	                                    <li id="90032" class="topmenu" data-type="lastMenuSub" data-url="http://www.jeasyui.cn/?from=demo">
	                                        <div class="l-btn-text bannerMenu">
	                                            <p><lable class="fa fa-link"></lable></p>
	                                            <p><span style="white-space:nowrap;">EasyUI中文站</span></p>
	                                        </div>
	                                    </li>
	                            	</ul>
	                          	</div>
	                      	</li>
	                 	</ul>
	             	</div>
	        	</div>
	    	</div>
		</div>
		
	    <div id="west"
	    	data-options="region:'west',split:true,width:260,border:false,headerCls:'border_right',bodyCls:'border_right'">
	     	<div id="RightAccordion"></div>
	    </div>
	
	    <div id="center"
	    	style="overflow:hidden;"
	    	data-options="region:'center',border:false">
	        <div id="index_tabs" class="easyui-tabs" style="width: 100%;height: 100%;">
	        	<div title="系统首页" style="padding: 10px;">
					<iframe th:src="@{welcome}" scrolling="auto" frameborder="0" style="width: 100%;height: 100%;"></iframe>
				</div>
	    	</div>
	    </div>
	
	    <div id="south" 
	    	style="text-align: center;height: 30px;line-height: 30px;border-bottom: 0;overflow: hidden;"
	    	data-options="region:'south',border:true">
	     	<span style="float: left;padding-left: 5px;width: 30%;text-align: left;">当前用户：<span id="user-username" sec:authentication="principal.username"></span></span>
	       	<span style="padding-right: 5px;width: 40%">
	            版权所有 © 2022 Renlm 
	            <a href="https://beian.miit.gov.cn" target="_blank" style="text-decoration: underline;color: black;">京ICP备2021000671号</a>
	        </span>
	   		<span style="float: right;padding-right: 5px;width: 30%;text-align: right;">版本：1.0.1</span>
		</div>
	</div>
	<script type="text/javascript">
	/**
	 * 当菜单选中时
	 * @param item
	 */
	function menuOnSelect(item) {
	    // 判断是否已经打开tab
	    var tabsArr = $("#index_tabs").tabs('tabs');
	    for (var i = 0; i < tabsArr.length; i++) {
	        var tab = tabsArr[i];
	        var options = $(tab).panel("options");
	        if (item.id && options.id && item.id == options.id) {
	            $("#index_tabs").tabs("select", i);// 选中
	            // $.refreshTab(tab, "");// 刷新
	            return;
	        }
	    }
	    // 不存在则添加菜单
	    if(item.url){
	        $("#index_tabs").tabs("add", {
	            title: item.text,
	            id: item.id,
	            isNewTab: true,
	            bodyCls: 'spacing-0', // 去除间隔
	            iconCls: item.iconCls,
	            closable: true,
	            content: '<iframe scrolling="auto" frameborder="0"  src="' + item.url + '" style="width:100%;height:100%;"></iframe>',
	        })
	    }

	}
	
	//菜单拖拽拉伸是调整大小
	function onResize(){
	    $('#RightAccordion').sidemenu('resize')
	}
	
	$(function () {

		
		$.get(
	            '[(@{/static/TopJUI-free/menu_1325.json})]', {"levelId": "2"}, // 获取第一层目录
	            function (data) {
	                var menuData = MyUI.getMenuTree(data);
	                $("#RightAccordion").sidemenu({
	                    width:255,
	                    data:menuData,
	                    fit: true,
	                    multiple:false,
	                    border: false,
	                    onSelect:menuOnSelect
	                });
	                // 初始化accordion
	                $("#RightAccordion .accordion").accordion({
	                    fit: true,
	                    multiple:false,
	                    border: false
	                });
	                $('#west').panel({onResize:onResize})     //菜单拖拽拉伸是调整大小
	            }, "json"
	        );
		
		$(".collapseMenu").on("click", function () {
	        var opts = $('#RightAccordion').sidemenu('options');
	        //改变面板布局
	        $('#index_layout').layout('panel','west').panel('resize', { width: opts.collapsed ? 260 : 60 })
	        $('#index_layout').layout();

	        // 改变slidemenu样式
	        $("#RightAccordion").sidemenu(opts.collapsed ? "expand" : "collapse")
	        $('#RightAccordion').sidemenu('resize', { width: opts.collapsed ? 60 : 260 })

	        /*改变图标样式*/
	        $("#menuCollapseIcon").addClass(opts.collapsed ? "fa-indent" : "fa-outdent")
	        $("#menuCollapseIcon").removeClass(opts.collapsed ? "fa-outdent" : "fa-indent")

	        // 选中菜单
	        if (!opts.collapsed) {
	            tabOnSelect();
	        }
	        // 改变菜单查询框
	        $(".systemname").css("display", opts.collapsed ? 'none' : 'inline-block');
	        $(".banner .nav-bar .webname").css("width", opts.collapsed ? 55 : 255);
	        $(".nav-bar .nav-center").css("marginLeft", opts.collapsed ? 0 : 255);
	        hideNavBtn();
	    });
		
		// 首页tabs选项卡
	    var index_tabs = $('#index_tabs').tabs({
	        fit: true,
	        tools: [{
	            iconCls: 'fa fa-home',
	            handler: function () {
	                $('#index_tabs').tabs('select', 0);
	            }
	        }, {
	            iconCls: 'fa fa-refresh',
	            handler: function () {
	                var refresh_tab = $('#index_tabs').tabs('getSelected');
	                var refresh_iframe = refresh_tab.find('iframe')[0];
	                refresh_iframe.contentWindow.location.href = refresh_iframe.src;
	            }
	        }, {
	            iconCls: 'fa fa-close',
	            handler: function () {
	                var index = $('#index_tabs').tabs('getTabIndex', $('#index_tabs').tabs('getSelected'));
	                var tab = $('#index_tabs').tabs('getTab', index);
	                if (tab.panel('options').closable) {
	                    $('#index_tabs').tabs('close', index);
	                }
	            }
	        }, {
	            iconCls: 'fa fa-arrows-alt',
	            handler: function () {
	                App().handleFullScreen();
	            }
	        }],
	        onSelect:tabOnSelect,
	        //监听右键事件，创建右键菜单
	        onContextMenu: function (e, title, index) {
	            e.preventDefault();
	            if (index >= 0) {
	                $('#mm').menu('show', {
	                    left: e.pageX,
	                    top: e.pageY
	                }).data("tabTitle", title);
	            }
	        }
	    });

	    //tab右键菜单
	    $("#mm").menu({
	        onClick: function (item) {
	            tabMenuOprate(this, item.name);
	        }
	    });
	});
	
    function hideNavBtn() {
        var contentWidth,areaWidth;
        var $navContentBox = $(".nav-group");
        //1.得到滚动内容的总长度 contentWidth；
        contentWidth = parseInt($navContentBox.width());

        //2.得到滚动区域的总长度 areaWidth;
        areaWidth = parseInt( $navContentBox.parent().width());

        if(contentWidth < areaWidth){
            $(".nav-btn").addClass('hide');
            $navContentBox.css('left',0)
        }else{
            $(".nav-btn").removeClass('hide')
        }
    }

    /**
     * tab选中时，选中menu菜单
     * @param title
     * @param index
     */
    function tabOnSelect(title, index) {
        var tabOpts = $('#index_tabs').tabs('getSelected').panel("options");
        var tabId = tabOpts.id, panels = $("#RightAccordion .accordion").accordion('panels');
        if(tabOpts.isNewTab || !tabId){
            tabOpts.isNewTab = !tabOpts.isNewTab;
            return;
        }
        $.each(panels, function (index, item) {
            var $tree = item.find('.tree');
            var node = $tree.tree('find', {id: tabId});
            if (node) {
                $("#RightAccordion .accordion").accordion('select', index) // 选中面板
                $tree.tree('expandTo', node.target).tree('select', node.target);// 选中tree选项
                $tree.tree('scrollTo', node.target);// 选中tree选项
                return false;
            }
        })
    }
    
    // Tab菜单操作
    function tabMenuOprate(menu, type) {
        var allTabs = $('#index_tabs').tabs('tabs');
        var allTabtitle = [];
        $.each(allTabs, function (i, n) {
            var opt = $(n).panel('options');
            if (opt.closable)
                allTabtitle.push(opt.title);
        });
        var curTabTitle = $(menu).data("tabTitle");
        var curTabIndex = $('#index_tabs').tabs("getTabIndex", $('#index_tabs').tabs("getTab", curTabTitle));
        switch (type) {
            case "1"://关闭当前
                if (curTabIndex > 0) {
                    $('#index_tabs').tabs("close", curTabTitle);
                    return false;
                    break;
                } else {
                    $.iMessager.show({
                        title: '操作提示',
                        msg: '首页不允许关闭！'
                    });
                    break;
                }
            case "2"://全部关闭
                for (var i = 0; i < allTabtitle.length; i++) {
                    $('#index_tabs').tabs('close', allTabtitle[i]);
                }
                break;
            case "3"://除此之外全部关闭
                for (var i = 0; i < allTabtitle.length; i++) {
                    if (curTabTitle != allTabtitle[i])
                        $('#index_tabs').tabs('close', allTabtitle[i]);
                }
                $('#index_tabs').tabs('scrollBy', 10);
                $('#index_tabs').tabs('select', curTabTitle);
                break;
            case "4"://当前侧面右边
                for (var i = curTabIndex; i < allTabtitle.length; i++) {
                    $('#index_tabs').tabs('close', allTabtitle[i]);
                }
                $('#index_tabs').tabs('select', curTabTitle);
                break;
            case "5": //当前侧面左边
                for (var i = 0; i < curTabIndex - 1; i++) {
                    $('#index_tabs').tabs('close', allTabtitle[i]);
                }
                $('#index_tabs').tabs('select', curTabTitle);
                break;
            case "6": //刷新
                var currentTab = $('#index_tabs').tabs('getSelected');
                var currentIframe = currentTab.find('iframe')[0];
                currentIframe.contentWindow.location.href = currentIframe.src;
                break;
            case "7": //在新窗口打开
                var refresh_tab = $('#index_tabs').tabs('getSelected');
                var refresh_iframe = refresh_tab.find('iframe')[0];
                window.open(refresh_iframe.src);
                break;
        }

    }
	</script>
</body>
</html>