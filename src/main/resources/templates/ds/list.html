<!DOCTYPE html>
<html lang="zh-CN" layout:decorate="~{layout/hadmin}">
<head>
	<title>更新记录</title>
	<!-- Bootstrap -->
	<link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet" />
</head>
<body layout:fragment="content" class="gray-bg">
	<div class="wrapper wrapper-content">
		<div class="row">
			<div class="col-sm-4">
				<div class="ibox">
					<div class="ibox-content" style="border-top: none;">
						<button type="button" 
							class="btn btn-block btn-primary compose-mail" 
							data-backdrop="static" 
							data-toggle="modal" 
							data-target="#dsModal"
							>新建
                       	</button>
						<div class="hr-line-dashed"></div>
						<h5>已支持数据库</h5>
						<ul class="category-list" style="padding: 0;">
							<li>
								<a href="javascript:void(0);">
									<i class="fa fa-circle text-danger"></i> MySQL
								</a>
							</li>
							<li>
								<a href="javascript:void(0);">
									<i class="fa fa-circle text-primary"></i> PostgreSQL
								</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="ibox float-e-margins animated fadeInUp">
               		<div class="ibox-title">
                  		<h5>数据源</h5>
					</div>
               		<div class="ibox-content">
                   		<table data-toggle="table" th:data-url="@{/ds/ajax/list}" data-height="250" data-mobile-responsive="true">
                       		<thead>
                           		<tr>
                                 	<th data-field="url">JDBC链接</th>
                               		<th data-field="schema">Schema</th>
                                  	<th data-field="username">账号</th>
                          		</tr>
                       		</thead>
                   		</table>
               		</div>
         		</div>
			</div>
			<div class="col-sm-8 animated fadeInRight">
				<div class="ibox ">
              		<div class="ibox-title">
                		<h5>数据库表</h5>
					</div>
                 	<div class="ibox-content">
                 		表格
                 	</div>
              	</div>
			</div>
		</div>
	</div>
	<div class="modal" id="dsModal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog">
			<div th:replace="fragments/spinners::circle"></div>
			<div class="modal-content animated flipInY">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span>
						<span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title">新建数据源</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal m-t-none" id="dsForm">
						<div class="form-group">
							<label class="col-sm-3 control-label">JDBC链接</label>
							<div class="col-sm-8">
								<input name="url" 
									type="text" 
									class="form-control required"
									placeholder="必填"
									autocomplete="off"
									data-vmsg="必填" 
									/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">Schema</label>
							<div class="col-sm-8">
								<input name="schema" 
									type="text" 
									class="form-control" 
									autocomplete="off" 
									/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">访问账号</label>
							<div class="col-sm-8">
								<input name="username" 
									type="text" 
									class="form-control required"
									placeholder="必填"
									autocomplete="off" 
									data-vmsg="必填" 
									/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">认证密码</label>
							<div class="col-sm-8">
								<input name="password" 
									type="password" 
									class="form-control required"
									placeholder="必填"
									autocomplete="new-password" 
									data-vmsg="必填" 
									/>
							</div>
						</div>
						<div class="form-group m-b-n-sm">
							<label class="col-sm-3 control-label">备注</label>
							<div class="col-sm-8">
								<textarea name="remark" 
									class="form-control" 
									rows="3">
								</textarea>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="submitDsForm();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Bootstrap table -->
    <script th:src="@{/webjars/bootstrap-table/bootstrap-table.min.js}"></script>
    <script th:src="@{/webjars/bootstrap-table/extensions/mobile/bootstrap-table-mobile.min.js}"></script>
    <script th:src="@{/webjars/bootstrap-table/locale/bootstrap-table-zh-CN.min.js}"></script>
	<script type="text/javascript">
		$(function () {
			/**
			 * 重置表单
			 */
			$("#dsModal").on("show.bs.modal", function () {
				$("#dsForm").clearform();
			}).on("hide.bs.modal", function () {
				$("#dsForm").clearform();
			});
		});
		/**
		 * 提交数据源表单
		 */
		function submitDsForm () {
			var dsForm = $("#dsForm");
			// 表单校验
			if(dsForm.valiform()) {
				$("#dsModal").find(".spiner-loading").addClass("show");
   				$.post(ctx + '/ds/ajax/save', 
   					dsForm.formJson(), 
   					function (resJson) {
   						$("#dsModal").find(".spiner-loading").removeClass("show");
						if(resJson.statusCode == 200) {
							$.toastrSuccess("数据源已添加");
							$("#dsModal").modal("hide");
			          	} else {
			          		swal("出错了", "添加数据源失败，请检查配置是否正确.", "error");
			        	}
					});		
			}
		}
	</script>
</body>
</html>