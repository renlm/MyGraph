<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title th:text="${markdown?.name}">Markdown文档</title>
	<meta charset="UTF-8" />
	<meta name="renderer" content="webkit" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
	<!-- Ico -->
    <link th:href="@{/static/favicon.ico}" rel="shortcut icon" />
	<!-- 全局设置 -->
    <script type="text/javascript">
    	window.CTX = window.ctx = "[(@{/})]".substr(0, "[(@{/})]".length - 1);
    </script>
	<!-- Jquery -->
	<script type="text/javascript" th:src="@{/webjars/jquery/dist/jquery.min.js}"></script>
	<!-- Js-base64 -->
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/js-base64/2.3.2/base64.min.js}"></script>
	<!-- Editor.md -->
	<link rel="stylesheet" th:href="@{/static/markdown/editor.md-1.5.0/css/editormd.preview.min.css}" />
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/marked.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/prettify.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/raphael.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/underscore.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/sequence-diagram.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/flowchart.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/lib/jquery.flowchart.min.js}"></script>
	<script th:src="@{/static/markdown/editor.md-1.5.0/editormd.js}"></script>
	<!-- 样式修正 -->
	<link rel="stylesheet" th:href="@{/static/css/scrollbar.css}" />
	<link rel="stylesheet" th:href="@{/static/css/markdown.css}" />
</head>
<body>
	<div class="layui-fluid">
		<div class="layui-row md-header">
			<div class="layui-col-md8">
				<h1 class="view-page-title" th:text="${docCategory.text}"></h1>
				<p class="view-page-path">
					<i class="fa fa-folder"></i>
					<strong th:each="father,iterStat : ${fathers}">
						<a th:text="${father.text}"></a>
						<th:block th:if="${iterStat.index < #lists.size(fathers) - 1}">/</th:block>
					</strong>
				</p>
				<p class="view-page-time">
	          		<i class="fa fa-calendar"></i>
	             	被<span class="nickname" th:text="${docCategory.creatorNickname}"></span> 创建于 <span class="time" th:text="${#calendars.format(docCategory.createdAt,'yyyy/MM/dd HH:mm:ss')}"></span>
	        		<th:block th:if="${!#strings.isEmpty(markdown?.updatorNickname)}">
	        			，被<span class="nickname" th:text="${markdown?.updatorNickname}"></span> 最后更新于 <span class="time" th:text="${#calendars.format(markdown?.createdAt,'yyyy/MM/dd HH:mm:ss')}"></span>
	        		</th:block>
	        		<th:block th:if="${markdown?.version != null}">
	        			，当前版本：<span class="version" th:text="${markdown?.version}"></span>
	        		</th:block>
	        	</p>
			</div>
			<div class="layui-col-md4">
				<div class="layui-btn-container">
					<button type="button" class="layui-btn layui-btn-primary" 
						th:data-uuid="${docCategory.uuid}" 
						th:data-title="${docCategory.text}"
						onclick="$.openMarkdownEditor($(this).data('uuid'), $(this).data('title'), onOpenEditor, onCloseEditor);">
						<i class="layui-icon layui-icon-edit"></i> 编辑
					</button>
					<button type="button" class="layui-btn layui-btn-primary">
						<i class="layui-icon layui-icon-star"></i> 收藏
					</button>
					<button type="button" class="layui-btn layui-btn-primary">
						<i class="layui-icon layui-icon-share"></i> 分享
					</button>
				</div>
			</div>
		</div>
		<hr/>
		<div class="md-body">
			<div class="md-catalog"></div>
			<div id="editormd" class="md-content"></div>
		</div>
	</div>
	<textarea id="markdown" class="layui-hide" th:text="${markdown?.content}"></textarea>
	<script th:src="@{/static/js/main.js}"></script>
	<script type="text/javascript">
		$(function () {
			editormd.markdownToHTML("editormd", {
				path            : "[(@{/static/markdown/editor.md-1.5.0/lib/})]",
                markdown		: $("#markdown").val(),
                htmlDecode      : "style,script,iframe|on*", 
              	tocm            : true,
             	emoji           : false,
              	taskList        : true,
              	tex             : true,
              	flowChart       : true,
             	sequenceDiagram : true
            });
		});
	</script>
	<script type="text/javascript">
		/**
		 * 打开Markdown文档编辑器（事件）
		 * @param params layero 当前层DOM
		 * @param params index 当前层索引
		 */
		function onOpenEditor (layero, index) {
			$(".md-body").addClass("editing");
		}
		
		/**
		 * 关闭Markdown文档编辑器（事件）
		 */
		function onCloseEditor () {
			$(".md-body").removeClass("editing");
		}
	</script>
</body>
</html>